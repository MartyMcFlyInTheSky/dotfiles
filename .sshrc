#!/bin/bash

echo "------ Loading session run control ---------"

if [ -n "$SSH_CONNECTION" ]; then
    echo "Running via SSH"

    MY_CONFIG_FS=/tmp
    if [ ! -d $MY_CONFIG_FS ]; then
        echo "Directory $MY_CONFIG_FS does not exist. Aborting script."
        exit 1
    fi

    MY_HOME=$MY_CONFIG_FS/sbeer/dotfiles
    export XDG_CONFIG_HOME=$MY_HOME/.config
    export XDG_DATA_HOME=$MY_HOME/.local
    export XDG_CACHE_HOME=$MY_HOME/.cache

    # Clone public repo via https
    git -C $MY_HOME pull --rebase || git clone https://github.com/MartyMcFlyInTheSky/dotfiles.git $XDG_CONFIG_HOME

    # Setup aliases used on server
    # alias tmux='tmux source $XDG_CONFIG_HOME/.tmux.conf; tmux'

    # Old vim on servers probably doesn't yet support XDG_CONFIG_HOME, use alias
    # https://github.com/vim/vim/pull/14182
    alias vim="vim -Nu $XDG_CONFIG_HOME/vim/vimrc"

    alias ssh=ssh -F $XDG_CONFIG_HOME/.ssh/config

    # Check if .bash_profile exists and source it
    if [ -f "$HOME/.bash_profile" ]; then
        source "$HOME/.bash_profile"
    elif [ -f "$HOME/.profile" ]; then
        source "$HOME/.profile"
    else
        echo "Neither .bash_profile nor .profile found"
    fi
else
    echo "Not running via SSH"

    MY_HOME=$HOME
    export XDG_CONFIG_HOME=$MY_HOME/.config
    export XDG_DATA_HOME=$MY_HOME/.local
    export XDG_CACHE_HOME=$MY_HOME/.cache

    # Setup aliases used locally
    alias vim=nvim

    alias ssh=ssh -F $XDG_CONFIG_HOME/.ssh/config

fi

# Common aliases

# enable color support of ls and also add handy aliases
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors && eval "$(dircolors -b ~/.dircolors)" || eval "$(dircolors -b)"
    alias ls='ls --color=auto'
    #alias dir='dir --color=auto'
    #alias vdir='vdir --color=auto'

    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
    alias egrep='egrep --color=auto'
fi

# You may want to put all your additions into a separate file like
# some more ls aliases
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'
alias lg='ls -alF | grep'

# Add an "alert" alias for long running commands.  Use like so:
#   sleep 10; alert
alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'

# Extend paths for tools
export PATH=$MY_HOME/.local/scripts/:$PATH
export PATH=$MY_HOME/bin:$PATH

bind -x '"\C-f": "tmux-sessionizer.sh"'
